---
title: 'API en direct : Création d'un clip précis de l'image'
parent: Guides 
grandparent: Live API
---
 <h1>Cette page a été déplacée. Vous serez dirigé vers le <a href="https://apis.support.brightcove.com/live-api/guides/live-api-creating-frame-accurate-clip.html">nouvel emplacement</a> dans 3 secondes. Veuillez mettre à jour vos signets !</h1>
<script type="text/javascript">
var t = setTimeout (function () { window.location.href = 'https://apis.support.brightcove.com/live-api/guides/live-api-creating-frame-accurate-clip.html'; }, 3000) ;
</script>
<article class="bcls-article">
  <h1>API en direct : Création d'un clip précis</h1>
  <summary>Ce tutoriel vous guide cependant en utilisant l'API Live pour créer un travail en direct, puis créer un clip précis à partir de celui-ci.</summary>




<section class="bcls-section">
<h2 id="Overview">Présentation</h2>
<!-- <figure class="bcls-figure">
        <img src="/assets/images/live-api/18699/block-diagram-small.png" alt="general-block-diagram" title="Block diagram">
        <figcaption class="bcls-caption--image">Block Diagram</figcaption>
      </figure> -->

<p>Ce didacticiel explique au niveau de l'API comment créer une tâche de streaming en direct dans <a href="/">Brightcove Live,</a> puis créer un clip précis à partir de celui-ci.</p>

<p>Notez que l'écrêtage précis de l'image nécessite que votre encodeur envoie des timecodes SMPTE.</p>

<p>Ce tutoriel utilisera <a translate="No" href="https://general.support.brightcove.com/developer/concepts-set-curl.html">curl</a> pour effectuer les requêtes API, mais vous pouvez facilement les créer dans <a translate="No" href="https://apis.support.brightcove.com/general/use-insomnia-api-requests.html">Insomnia</a>, <a translate="No" href="https://apis.support.brightcove.com/general/use-postman-api-requests.html">Postman</a> ou d'autres clients REST.</p>
</section>

<section class="bcls-section">
<h2 id="create_a_live_job">Créer un travail en direct</h2>

<p>Tout d'abord, nous allons créer un emploi en direct. Vous aurez besoin d'un <code translate="No">API-KEY</code> pour l'API Live. Si vous ne le faites pas et que vous êtes intéressé à obtenir l'accès, veuillez contacter votre gestionnaire de compte.</p>

<ol class="bcls-tasklist">
	<li>Nous supposons que vous avez déjà un acount Brightcove et ils vous avez votre API-KEY, appelons-le <code translate="No">bcov-live-api-key</code></li>
	<li>
	<p>Copiez et collez ce qui suit <span translate="No">boucle</span> commande dans un éditeur de texte :</p>

	<pre class="line-numbers">
  <code class="language-bash" translate="No">curl -X POST \
    https://api.bcovlive.io/v1/jobs \
    -H 'Content-Type: application/json' \
    -H 'x-api-key: {{bcov-live-api-key}}' \
    -d '{
      "live_stream": true,
      "region": "{{closest-region-encoder}}",
      "outputs": [{
        "label": "hls360p",
        "live_stream": true,
        "height": 360,
        "video_bitrate": 365,
        "segment_seconds": 6,
        "keyframe_interval": 60
      },
      {
        "label": "hls432p",
        "live_stream": true,
        "height": 432,
        "video_bitrate": 730,
        "segment_seconds": 6,
        "keyframe_interval": 60
      },
      {
        "label": "hls540p",
        "live_stream": true,
        "height": 540,
        "video_bitrate": 2000,
        "segment_seconds": 6,
        "keyframe_interval": 60
      },
      {
        "label": "hls720p3M",
        "live_stream": true,
        "height": 540,
        "video_bitrate": 2000,
        "segment_seconds": 6,
        "keyframe_interval": 60
      },
      {
        "label": "hls720p4.5M",
        "live_stream": true,
        "height": 540,
        "video_bitrate": 4500,
        "segment_seconds": 6,
        "keyframe_interval": 60
      }]
    }'
  </code></pre>
	</li>
	<li>
	<p><strong>Remplacer :</strong></p>

	<ul>
		<li><code translate="No">{{closest-region-encoder}}</code> avec la région disponible la plus proche de votre encodeur, voir <a href="/live-api/getting-started/overview-brightcove-live-api.html#Support_aws_regions">régions disponibles les plus proches</a> à votre encodeur. Par exemple : <code translate="No">us-west-2</code></li>
		<li><code translate="No">{{bcov-live-api-key}}</code> avec votre clé API Brightcove live. Par exemple : <code translate="No">abcdfeg-this-is-a-fake-api-key-FgJajjasd12hJHsZ</code></li>
	</ul>
	</li>
	<li>Après avoir apporté ces modifications, copiez et collez le code dans Terminal ou toute application de ligne de commande que vous utilisez et exécutez-le.</li>
	<li>
	<p>La réponse devrait être quelque chose comme ceci :</p>

	<pre class="line-numbers">
  <code class="language-json" translate="No">{
      "id": "3b6871bf2f344acaa6b397d09b476018",
      "outputs": [... removed for simplicity ...],
      "stream_url": "rtmp://ep1-usw2.bcovlive.io:1935/3b6871bf2f344acaa6b397d09b476018",
      "stream_name": "alive",
      "static": false,
      "encryption": {},
      "playback_url": "https://bcovlive-a.akamaihd.net/3b6871bf2f344acaa6b397d09b476018/us-west-2/NA/playlist.m3u8",
      "playback_url_dvr": "https://bcovlive-a.akamaihd.net/3b6871bf2f344acaa6b397d09b476018/us-west-2/NA/playlist_dvr.m3u8"
  }</code></pre>
	</li>
</ol>

<p>Ces tâches créeront 5 formats associés <strong>basés</strong> sur les <a href="https://developer.apple.com/documentation/http_live_streaming/hls_authoring_specification_for_apple_devices">recommandations Apple</a>.</p>
</section>

<section class="bcls-section">
<h2 id="Configure_your_encoder">Configuration de l'encodeur</h2>

<p>Les étapes indiquées ici supposeront une <a href="https://www.elemental.com/products/aws-elemental-live">Live box élémentaire</a> encodeur, qui a été utilisé pour tester les étapes de ce didacticiel. Si vous avez un encodeur différent, les paramètres doivent être similaires.</p>

<p>Les paramètres les plus importants pour ce cas sont :</p>

<ul>
	<li>Configurer la source du code temporel comme « horloge système »</li>
	<li>Réglez « fréquence du code temporel OnFi » sur 1</li>
	<li>Cochez « insertion du code temporel » dans la vidéo</li>
	<li>Fortement recommandé : Framerate = suivre la source</li>
</ul>

<p>C'est la configuration que nous avons utilisée pour cette expérience :</p>

<figure class="bcls-figure"><img alt="elemental-live-job-config" title="Elemental live config" src="/assets/images/live-api/18699/elemental-live-job-config-v1-small.png" />
<figcaption class="bcls-caption--image">Configuration élémentaire en direct</figcaption>
</figure>
</section>

<section class="bcls-section">
<h2 id="test_playback">Tester la lecture</h2>

<p>Vous pouvez utiliser cette <a href="https://videojs.github.io/videojs-contrib-hls/">page de démonstration HLS VideoJS</a> pour tester la lecture, il suffit de coller la valeur <code translate="No">playback_url</code> renvoyée dans la réponse du travail de création :</p>

<figure class="bcls-figure"><img alt="videojs-hls-playback" title="VideoJS HLS playback demo page" src="/assets/images/live-api/18699/videojs-hls-playback-small.png" />
<figcaption class="bcls-caption--image">VideoJS page de démonstration de lecture HLS</figcaption>
</figure>
</section>

<section class="bcls-section">
<h2 id="create_frame_accurate_clip">Création d'un clip avec précision du cadre</h2>

<p>Dans ce didacticiel, nous supposerons que vous envoyez le clip à votre bibliothèque Video Cloud. Si vous envoyez le clip vers un compartiment S3 ou un autre emplacement, le processus est le même : il y a quelques différences mineures dans le corps de la requête pour les demandes d'API.</p>

<section class="bcls-subsection">
<h3 id="video-cloud-credentials">Informations d'identification</h3>

<p>Si vous n'avez pas créé d'informations d'identification pour Video Cloud dans votre compte Live, vous pouvez suivre les étapes ci-dessous pour ce faire. Il s'agit d'une opération unique.</p>

<p>Si vous ne disposez pas encore d'informations d'identification client pour Dynamic Ingest de vidéos vers Video Cloud, vous devrez les créer. Reportez-vous à <a href="https://studio.support.brightcove.com/admin/managing-api-authentication-credentials.html">la section Gestion des informations d'authentification API</a> pour obtenir des instructions sur la procédure à suivre dans Studio.</p>

<ol class="bcls-tasklist">
	<li>Copiez la commande curl ci-dessous dans un éditeur de texte :
	<pre class="line-numbers">
<code class="language-bash" translate="No">curl -X POST \ https://api.bcovlive.io/v1/credentials \ -H 'Content-Type: application/json' \ -H 'x-api-key: {{bcov-live-api-key}}' \ -d '{ "credential_default_for_type": true, "credential_label": "Video_Cloud_Uploads", "credential_private": "{{client_secret}}", "credential_public": "{{client_id}}", "credential_type": "videocloud" }' </code></pre>
	</li>
	<li>
	<p><strong>Remplacer :</strong></p>

	<ul>
		<li><code translate="No">{{bcov-live-api-key}}</code> avec votre clé API Live</li>
		<li><code translate="No">{{client_secret}}</code> avec votre secret client</li>
		<li><code translate="No">{{client_id}}</code> avec votre identifiant client</li>
	</ul>
	</li>
	<li>Copiez et collez la commande modifiée dans Terminal ou dans votre application de ligne de commande, puis exécutez-la.</li>
	<li>La réponse devrait ressembler à ceci :
	<pre class="line-numbers">
  <code class="language-json" translate="No">{
    "credential_id": "1e0180330b724dfbbcaf6b28b6c5d517",
    "user_id": "c2691d4d039040be96c190a949d754a7",
    "credential_label": "Video_Cloud_Uploads"
  }</code></pre>
	</li>
</ol>
</section>

<section class="bcls-subsection">
<h3 id="create_clip">Créer le clip</h3>

<p>Une fois que vous disposez de vos informations d'identification Video Cloud, vous êtes prêt à créer un clip.</p>

<ol class="bcls-tasklist">
	<li>Copiez la requête curl ci-dessous et collez-la dans un éditeur de texte :
	<pre class="line-numbers">
  <code class="language-bash" translate="No">curl -X POST \
    https://api.bcovlive.io/v1/vods \
    -H 'Content-Type: application/json' \
    -H 'x-api-key: {{bcov-live-api-key}}' \
    -d '{
      "live_job_id":"{{bcov-live-job-id}}",
      "outputs":[{
          "label": "Trim by SMPTE TC 17:33:11:12 to 17:34:00:00",
        "stream_start_timecode": "{{timecode-in}}",
        "stream_end_timecode": "{{timecode-out}}",
          "videocloud":{"ingest":{"capture-images":true},"video":{"name":"test-frame-accurate-clip"}},
          "credentials": "{{video-cloud-credentials}}"
      }]
  }'</code></pre>
	</li>
	<li>
	<p><strong>Remplacer :</strong></p>

	<ul>
		<li><code translate="No">{{bcov-live-api-key}}</code> avec votre clé API Brightcove live. Par exemple : <code translate="No">abcdfeg-this-is-a-fake-api-key-FgJajjasd12hJHsZ</code></li>
		<li><code translate="No">{{bcov-live-job-id}}</code> avec l'identifiant de la tâche dans la réponse à votre demande de création de la tâche en direct. Dans notre exemple, cette valeur serait <code translate="No">3b6871bf2f344acaa6b397d09b476018</code>: la vôtre sera différente.</li>
		<li><code translate="No">{{timecode-in}}</code> et <code translate="No">{{timecode-out}}</code> doivent être des valeurs qui ont du sens (sont présentes) dans votre diffusion en direct. Dans notre exemple, nous avons utilisé : <code translate="No">17:33:11:12</code> et <code translate="No">17:34:00:00</code></li>
		<li><code translate="No">{{video-cloud-credentials}}</code> avec l'étiquette de vos informations d'identification Video Cloud. Si vous ne les aviez pas déjà et que vous les avez créés en utilisant les étapes ci-dessus, cela serait <code translate="No">Video_Cloud_Uploads</code></li>
	</ul>
	</li>
	<li>Copiez et collez le code modifié dans Terminal ou dans votre application de ligne de commande, puis exécutez-le.</li>
	<li>La réponse devrait ressembler à ceci :
	<pre class="line-numbers">
  <code class="language-json" translate="No">{
      "vod_jobs": [
          {
              "jvod_id": "0b14a4ba326d4dd08f15053ca2a403b7",
              "label": "Trim by SMPTE Timecodes"
          }
      ],
      "live_job_id": "3b6871bf2f344acaa6b397d09b476018"
  }</code></pre>
	</li>
</ol>

<p>Nous avons testé la précision de l'expérience, nous avons téléchargé le clip et utilisé <a href="https://www.adobe.com/products/premiere.html">Adobe Premiere</a> pour vérifier la première et la dernière image, puisque le code temporel est superjeté, une simple vérification visuelle suffit pour confirmer la précision aux points d'entrée et de sortie :</p>

<figure class="bcls-figure"><img alt="clip-accuracy-in" title="Visual clip accuracy test - in" src="/assets/images/live-api/18699/clip-accuracy-in-small.png" />
<figcaption class="bcls-caption--image">Test de précision visuelle des clips - en</figcaption>
</figure>

<figure class="bcls-figure"><img alt="clip-accuracy-out" title="Visual clip accuracy test - out" src="/assets/images/live-api/18699/clip-accuracy-out-small.png" />
<figcaption class="bcls-caption--image">Test de précision visuelle du clip - sortie</figcaption>
</figure>

<p>&nbsp;</p>
</section>
</section>
</article>