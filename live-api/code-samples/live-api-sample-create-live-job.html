---
title: 'Exemple d'API en direct : Créer une tâche en direct'
parent: Code Samples 
grandparent: Live API
---
 <h1>Cette page a été déplacée. Vous serez dirigé vers le <a href="https://apis.support.brightcove.com/live-api/code-samples/live-api-sample-create-live-job.html">nouvel emplacement</a> dans 3 secondes. Veuillez mettre à jour vos signets !</h1>
<script type="text/javascript">
var t = setTimeout (function () { window.location.href = 'https://apis.support.brightcove.com/live-api/code-samples/live-api-sample-create-live-job.html'; }, 3000) ;
</script>
<article class="bcls-article">
  <h1>Exemple d'API en direct : Créer un travail en direct</h1>
  <summary>Dans cet exemple, vous apprendrez comment créer un travail en direct simple.</summary>


<section class="bcls-section">
<h2 id="Introduction">Introduction</h2>

<p>Cet exemple crée un travail Live simple avec trois formats associés en sortie : 1080p, 720p et 480p.</p>

<p>Parce que le <span translate="No">API en direct</span> n'est pas compatible CORS et doit être accessible depuis une application côté serveur, la requête API est envoyée via un simple proxy écrit en PHP. Vous pouvez le reproduire dans n'importe quelle langue côté serveur : il suffit de collecter les paramètres de demande envoyés par le JavaScript, d'envoyer la demande à l'API et de renvoyer la réponse au JavaScript. Tout le code peut être trouvé dans la <a href="#code">section de code ci-dessous</a>.</p>
</section>

<section class="bcls-section">
<h2 id="create_live_job_app">Créer une application de travail en direct</h2>
Trouvez tout le code associé à cet exemple dans ce <a href="https://github.com/BrightcoveLearning/18519-live-api-sample-create-live-job">dépôt GitHub</a>.

<p data-height="1400" data-theme-id="dark" data-slug-hash="ZoYoVY" data-default-tab="result" data-user="rcrooks1969" data-embed-version="2" data-pen-title="Live API Sample: Create a Live Job" class="codepen">Voir l' <a href="https://codepen.io/team/rcrooks1969/pen/ZoYoVY/">exemple d'API Pen Live : Créez un emploi en direct</a> par Brightcove Learning Services (<a href="https://codepen.io/rcrooks1969">@rcrooks1969</a>) sur <a href="https://codepen.io">CodePen</a>.</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script></section>

<section class="bcls-section">
<h2 id="Using_the_CodePen" class="bcls-expander-head">Utilisation du CodePen</h2>

<div class="bcls-expander-content">
<p>Voici quelques conseils pour utiliser efficacement le CodePen ci-dessus :</p>

<ul>
	<li>Basculez l'affichage réel du lecteur en cliquant sur le <strong>Résultat</strong> bouton.</li>
	<li>Cliquez sur les boutons <strong>HTML/CSS/JS</strong> pour afficher L'UN des types de code.</li>
	<li>Cliquez <strong>sur Modifier sur CodePen</strong> dans le coin supérieur droit pour incorporer ce CodePen dans votre propre compte.</li>
	<li>Trouvez tout le code associé à cet exemple dans ce <a href="https://github.com/BrightcoveLearning/18519-live-api-sample-create-live-job">dépôt GitHub</a>.</li>
</ul>
</div>
</section>

<section class="bcls-section">
<h2 id="code">Code proxy</h2>

<p>En plus du code trouvé dans CodePen (et le repo GitHub associé), cet exemple nécessite un proxy pour effectuer la requête API et retourner la réponse à l'application. Pour cette application, nous avons utilisé PHP, et le code est montré ci-dessous. Vous pouvez utiliser n'importe quel langage côté serveur pour créer le proxy.</p>

<pre class="line-numbers">
<code class="language-php">&lt;? php /** * live-proxy.php - proxy pour les API Brightcove Live * effectue la demande et renvoie la réponse* Accès :* (notez que vous devez *toujours* accéder au proxy via HTTPS) * Méthode : POST * * @post {string} url - URL de la demande d'API * @post {string} [RequestType=Get] - Méthode HTTP pour la demande* @post {string} [RequestBody] - Données JSON à envoyer avec des demandes d'écriture * @post {string} ApiKey - Live Clé API * * @returns {string} $response - réponse JSON reçue de l'API *///CORS enablement et d'autres en-têtes (« Access-Control-Allow-Origin :* ») ; en-tête (« Content-Type : application/json ») ; en-tête (« X-Content-Type-Options : nosniff ») ; en-tête (« X-XSS -Protection ») ; $RequestData = json_decode (file_get_contents ('php : //input')) ;//configurer l'appel API//obtenir la clé API $apikey = $RequestData-&gt;APIKey ;//obtenir le type de requête ou par défaut GET si ($RequestData-&gt;RequestType) { $method = $requestData-&gt;requestType; } else { $method = "GET"; }//plus vérifications de sécurité $needle = '.io' ; $endapi = strpos ($requestData-&gt;URL, $needle) + 3 ; $nextChar = substr ($requestData-&gt;URL, $endapi, 1) ; if (strpos ($requestData-&gt;URL, 'api.bcovlive.io') == faux) { exit('{"ERROR":"Only requests to Brightcove Live APIs are accepted by this proxy"}') ;} sinon si ($nextCar ! == '/'  $NextChar ! == '? ') { exit('{"ERROR": "There was a problem with your API request - please check the URL"}') ;}//Obtenir l'URL et les informations d'autorisation à partir des données du formulaire $request = $RequestData-&gt;URL ; //envoyer la demande http si ($RequestData-&gt;RequestBody) { $ch = curl_init($request); curl_setopt_array($ch, array( CURLOPT_CUSTOMREQUEST =&gt; $method, CURLOPT_RETURNTRANSFER =&gt; TRUE, CURLOPT_SSL_VERIFYPEER =&gt; FALSE, CURLOPT_HTTPHEADER =&gt; array( 'Content-type: application/json', "X-API-KEY: {$apikey}«,), CURLOPT_POSTFIELDS =&gt; $RequestData-&gt;RequestBody)) ; $response = curl_exec ($ch) ; curl_close ($ch) ;} else { $ch = curl_init($request); curl_setopt_array($ch, array( CURLOPT_CUSTOMREQUEST =&gt; $method, CURLOPT_RETURNTRANSFER =&gt; TRUE, CURLOPT_SSL_VERIFYPEER =&gt; FALSE, CURLOPT_HTTPHEADER =&gt; array( 'Content-type: application/json', "X-API-KEY: {$apikey}«,))) ; $response = curl_exec ($ch) ; curl_close ($ch) ;}//Vérifiez si ($response === FALSE) { $logEntry = "\nError:\n". "\n".date("Y-m-d H:i:s")." UTC \n" .$response; $logFileLocation = "log.txt"; $fileHandle = fopen($logFileLocation, 'a') or die("-1"); fwrite($fileHandle, $logEntry); fclose($fileHandle); echo '{"ERROR": "There was a problem with your API call"}'+ die (curl_error ($ch)) ;}//Décoder la réponse//$responseData = json_decode ($response, TRUE) ;//renvoie le réponse à l'appelant AJAX $responseDecoded = json_decode ($response) ;//if (! isset ($responseDecoded)) { // $response = '{null}';//} echo $response ; ? &gt; </code></pre>
</section>

<script src="//learning-services-media.brightcove.com/doc-assets/node/18519-live-api-sample-create-live-job/create-job.js">

</script>

</article>